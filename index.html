<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>APQuery.net by leocaan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">APQuery.net</h1>
      <h2 class="project-tagline">APQuery.net is a open source ORM framework. Entity, Dal and Bpl everything is objectization, even SQL expression. Most close to the SQL syntax.</h2>
      <a href="https://github.com/leocaan/APQuery.net" class="btn">View on GitHub</a>
      <a href="https://github.com/leocaan/APQuery.net/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/leocaan/APQuery.net/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="apquerynet" class="anchor" href="#apquerynet" aria-hidden="true"><span class="octicon octicon-link"></span></a>APQuery.net</h1>

<p>APQuery.net is a lightweight ORM, open source framework. With the objectization of the database, 
SQL expression, database access layout, business logic process and data entity.</p>

<p><strong>Home page, documentation, and support links: <a href="http://leocaan.github.io/APQuery.net/">http://leocaan.github.io/APQuery.net/</a></strong></p>

<p><strong>Some demos will be links: <a href="https://github.com/leocaan/APQuery.net-Demo/">https://github.com/leocaan/APQuery.net-Demo/</a></strong></p>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<ul>
<li>Install <strong>APQuery.net Library Package</strong> from <strong>Nuget</strong>, search as the key "APQuery".</li>
<li>Install <strong>APQuery.net Add-in</strong> from <strong>Expanded and updated</strong>, 
Visual Studio Menu -&gt; Tools -&gt; Expanded and updated, search as the key "APQuery".</li>
</ul>

<p><a href="http://i57.tinypic.com/16iv2j9.jpg"><img src="http://i57.tinypic.com/16iv2j9.jpg" alt=""></a></p>

<ul>
<li>Right click contextmenu on the project folder and click <strong>Add new .apgen file</strong>
to create a <strong>business.apgen</strong> file, this file is the ORM mapping file.</li>
</ul>

<p><a href="http://i58.tinypic.com/n32qv5.jpg"><img src="http://i58.tinypic.com/n32qv5.jpg" alt=""></a></p>

<ul>
<li>If you project is WebSite, ensure the file is in the <strong>App_Code</strong> folder will be auto generated.</li>
<li>Or if you project is WebApplication, right click context menu on the file and click
<strong>Generate the .apgen file</strong> item will be generated <strong>business.apgen.cs</strong> in project.</li>
</ul>

<p><a href="http://i59.tinypic.com/2638nmh.jpg"><img src="http://i59.tinypic.com/2638nmh.jpg" alt=""></a></p>

<ul>
<li>Edit <strong>Global.asax</strong>, add <strong>Symber.Web.Compilation.APGenManager.SyncAndInitData();</strong> in the
<strong>Application_Start</strong> method, that will be automatically create and maintain the DATABASE and
initialization data.</li>
</ul>

<h2>
<a id="about-the-agpen-file" class="anchor" href="#about-the-agpen-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>About the .agpen file</h2>

<p>Look at here simple, the details please refer to the documents.</p>

<div class="highlight highlight-xml"><pre>&lt;<span class="pl-ent">businessModel</span> <span class="pl-e">autoSyncDatabase</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">autoInitDatabase</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">tables</span>&gt;
    &lt;<span class="pl-ent">table</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Department<span class="pl-pds">"</span></span> <span class="pl-e">comment</span>=<span class="pl-s"><span class="pl-pds">"</span>Departments of company<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">columns</span>&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>DepartmentId<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">primaryKey</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">identityType</span>=<span class="pl-s"><span class="pl-pds">"</span>Provider<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>ParentId<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">comment</span>=<span class="pl-s"><span class="pl-pds">"</span>Parent DepartmentId<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>DeptName<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> <span class="pl-e">dataLength</span>=<span class="pl-s"><span class="pl-pds">"</span>20<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Phone<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> <span class="pl-e">dataLength</span>=<span class="pl-s"><span class="pl-pds">"</span>20<span class="pl-pds">"</span></span>/&gt;
      &lt;/<span class="pl-ent">columns</span>&gt;
      &lt;<span class="pl-ent">uniques</span>&gt;
        &lt;<span class="pl-ent">index</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>IX_Department_DeptName<span class="pl-pds">"</span></span>&gt;
          &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>DeptName<span class="pl-pds">"</span></span> <span class="pl-e">according</span>=<span class="pl-s"><span class="pl-pds">"</span>Asc<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">index</span>&gt;
      &lt;/<span class="pl-ent">uniques</span>&gt;
      &lt;<span class="pl-ent">aliases</span>&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Parent<span class="pl-pds">"</span></span>/&gt;
      &lt;/<span class="pl-ent">aliases</span>&gt;
    &lt;/<span class="pl-ent">table</span>&gt;

    &lt;<span class="pl-ent">table</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Employee<span class="pl-pds">"</span></span> <span class="pl-e">comment</span>=<span class="pl-s"><span class="pl-pds">"</span>Employees of company<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">columns</span>&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>EmployeeId<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">primaryKey</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">identityType</span>=<span class="pl-s"><span class="pl-pds">"</span>Provider<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>DepartmentId<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">comment</span>=<span class="pl-s"><span class="pl-pds">"</span>Employee's DeparentId<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Name<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> <span class="pl-e">dataLength</span>=<span class="pl-s"><span class="pl-pds">"</span>30<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Birthday<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>DateTime<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Email<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> <span class="pl-e">dataLength</span>=<span class="pl-s"><span class="pl-pds">"</span>255<span class="pl-pds">"</span></span>/&gt;
      &lt;/<span class="pl-ent">columns</span>&gt;
      &lt;<span class="pl-ent">indexes</span>&gt;
        &lt;<span class="pl-ent">index</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>IX_Employee_Name<span class="pl-pds">"</span></span> <span class="pl-e">isDefault</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;
          &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Name<span class="pl-pds">"</span></span> <span class="pl-e">according</span>=<span class="pl-s"><span class="pl-pds">"</span>Asc<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">index</span>&gt;
      &lt;/<span class="pl-ent">indexes</span>&gt;
    &lt;/<span class="pl-ent">table</span>&gt;             
  &lt;/<span class="pl-ent">tables</span>&gt;
&lt;/<span class="pl-ent">businessModel</span>&gt;</pre></div>

<h2>
<a id="what-objectizations-does-we-have" class="anchor" href="#what-objectizations-does-we-have" aria-hidden="true"><span class="octicon octicon-link"></span></a>What objectizations does we have</h2>

<pre><code>---------------------------------------------------------------------
Entity Defined                          |   Department
---------------------------------------------------------------------
Database Struct Defined                 |   APDBDef.Department
---------------------------------------------------------------------
Data Access Layout (Dal) Defined        |   APDalDef.DepartmentDal
---------------------------------------------------------------------
Business Process Logic (Bpl) Defined    |   APBplDef.DepartmentBpl
---------------------------------------------------------------------
</code></pre>

<h2>
<a id="usage-of-orm" class="anchor" href="#usage-of-orm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage of ORM</h2>

<p><strong>Insert a data</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> dep = <span class="pl-k">new</span> Department(<span class="pl-c1">1</span>, <span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">"</span>Sales<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>000-000-0000<span class="pl-pds">"</span></span>);
dep.Insert();</pre></div>

<p><strong>Delete a data</strong></p>

<div class="highlight highlight-cs"><pre>Department.PrimaryDelete(<span class="pl-c1">1</span>);</pre></div>

<p><strong>Condition delete</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-c">// short refer name</span>
<span class="pl-k">var</span> t = APDBDef.Department;
Department.ConditionDelete(t.ParentId == <span class="pl-c1">0</span> &amp; t.DeptName != <span class="pl-s"><span class="pl-pds">"</span>Sales<span class="pl-pds">"</span></span>);</pre></div>

<p><strong>Get data with primary key and update</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> dep = Department.PrimaryGet(<span class="pl-c1">1</span>);
dep.Phone = <span class="pl-s"><span class="pl-pds">"</span>000-000-0001<span class="pl-pds">"</span></span>;
dep.Update();</pre></div>

<p><strong>Partial update</strong></p>

<div class="highlight highlight-cs"><pre>Department.UpdatePartial(<span class="pl-c1">1</span>, <span class="pl-k">new</span> { Phone=<span class="pl-s"><span class="pl-pds">"</span>000-000-5555<span class="pl-pds">"</span></span>, DeptName=<span class="pl-s"><span class="pl-pds">"</span>New Seals<span class="pl-pds">"</span></span>});</pre></div>

<p><strong>Condition query and order</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> t = APDBDef.Department;
List&lt;Department&gt; list = Department.ConditionQuery(
   t.ParentId == <span class="pl-c1">0</span> &amp; t.DeptName != <span class="pl-s"><span class="pl-pds">"</span>Sales<span class="pl-pds">"</span></span>,  <span class="pl-c">// condition</span>
   t.DepartmentId.Desc);                     <span class="pl-c">// order</span></pre></div>

<p><strong>Paging query</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> t = APDBDef.Department;
List&lt;Department&gt; list = Department.ConditionQuery(
   t.ParentId == <span class="pl-c1">0</span> &amp; t.DeptName != <span class="pl-s"><span class="pl-pds">"</span>Sales<span class="pl-pds">"</span></span>,  <span class="pl-c">// condition</span>
   t.DepartmentId.Desc,                      <span class="pl-c">// order</span>
   <span class="pl-c1">20</span>, <span class="pl-c1">20</span>);       <span class="pl-c">// take 20 records, skip ahead 20 records</span></pre></div>

<p><strong>Query count</strong></p>

<div class="highlight highlight-cs"><pre>Department.ConditionQueryCount(t.ParentId != <span class="pl-c1">0</span>);</pre></div>

<p><strong>Transcation and Dal</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">using</span> (APDBDef db = <span class="pl-k">new</span> APDBDef())
{
   db.BeginTrans();

   <span class="pl-k">try</span>
   {
      db.DepartmentDal.PrimaryDelete(<span class="pl-c1">1</span>);
      db.EmployeeDal.ConditionDelete(APDBDef.Employee.DepartmentId == <span class="pl-c1">1</span>);

      db.Commit();
   }
   <span class="pl-k">catch</span>
   {
      db.Rollback();
   }
}</pre></div>

<h2>
<a id="usage-of-sql-expression" class="anchor" href="#usage-of-sql-expression" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage of SQL Expression</h2>

<p>Sometimes the ORM can't meet our requirement, so we can directly use SQL Expression.
Of course, the core of ORM is also dependent on SQL Expression.</p>

<p><strong>Asterisk Query</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> dep = APDBDef.Department;
<span class="pl-k">using</span> (APDBDef db = <span class="pl-k">new</span> APDBDef())
{
   IEnumerable&lt;Department&gt; result = APQuery
      .<span class="pl-k">select</span>(dep.Asterisk).distinct()
      .<span class="pl-k">from</span>(dep)
      .<span class="pl-k">where</span>(dep.ParentId == <span class="pl-c1">0</span> &amp; dep.Phone != <span class="pl-c1">null</span>)
      .order(dep.DeptName.Desc)
      .query(db, dep.Map);
}</pre></div>

<p>Execute on SQLServer provider.</p>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT DISTINCT</span> Department.<span class="pl-k">*</span> 
  <span class="pl-k">FROM</span> Department
  <span class="pl-k">WHERE</span> <span class="pl-c1">Department</span>.<span class="pl-c1">ParentId</span> <span class="pl-k">=</span> <span class="pl-c1">0</span> <span class="pl-k">AND</span> <span class="pl-c1">Department</span>.<span class="pl-c1">Phone</span> <span class="pl-k">IS NOT NULL</span>
  <span class="pl-k">ORDER BY</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span> <span class="pl-k">DESC</span></pre></div>

<p>In the following, we only write SQL Expression.</p>

<p><strong>Value and through expression (New)</strong></p>

<p>'~' is a escape character, a string startwith '~' while be through parse after expression.</p>

<div class="highlight highlight-cs"><pre>APQuery
   .<span class="pl-k">select</span>(dep.DepartmentId, <span class="pl-c1">3</span>, <span class="pl-s"><span class="pl-pds">"</span>abc<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>~3*3<span class="pl-pds">"</span></span>, <span class="pl-c1">null</span>)
   .<span class="pl-k">from</span>(dep);</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>, <span class="pl-c1">3</span>, <span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>, <span class="pl-c1">3</span><span class="pl-k">*</span><span class="pl-c1">3</span>, <span class="pl-k">NULL</span>
  <span class="pl-k">FROM</span> Department</pre></div>

<p><strong>Column Alias</strong></p>

<div class="highlight highlight-cs"><pre>APQuery
   .<span class="pl-k">select</span>(dep.DepartmentId, dep.DeptName.As(<span class="pl-s"><span class="pl-pds">"</span>Name<span class="pl-pds">"</span></span>), dep.Phone.As(<span class="pl-s"><span class="pl-pds">"</span>Dept Phone<span class="pl-pds">"</span></span>))
   .<span class="pl-k">from</span>(dep);</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span> <span class="pl-k">AS</span> Name,
       <span class="pl-c1">Department</span>.<span class="pl-c1">Phone</span> <span class="pl-k">AS</span> [Dept Phone]
  <span class="pl-k">FROM</span> Department</pre></div>

<p><strong>Multi-table query</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
<span class="pl-k">var</span> e = APDBDef.Employee;
APQuery
   .<span class="pl-k">select</span>(e.EmployeeId, d.DeptName, e.Name)
   .<span class="pl-k">from</span>(d, e.JoinInner(d.DepartmentId == e.DepartmentId))
   .<span class="pl-k">where</span>(d.ParentId.NotIn(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>));</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span>, <span class="pl-c1">Employee</span>.<span class="pl-c1">Name</span>
  <span class="pl-k">FROM</span> Department
  <span class="pl-k">INNER JOIN</span> Employee <span class="pl-k">ON</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">==</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">DepartmentId</span>
  <span class="pl-k">WHERE</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">IN</span> ( <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span> )</pre></div>

<p><strong>Alias table query</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
<span class="pl-k">var</span> dp = APDBDef.Department.Parent;
APQuery
   .<span class="pl-k">select</span>(d.DepartmentId, d.DeptName, dp.DeptName.As (<span class="pl-s"><span class="pl-pds">"</span>ParentName<span class="pl-pds">"</span></span>))
   .<span class="pl-k">from</span>(d, dp.JoinLeft(d.ParentId == dp.DepartmentId))
   .<span class="pl-k">where</span>(dp.DeptName.Match(<span class="pl-s"><span class="pl-pds">"</span>ale<span class="pl-pds">"</span></span>));</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span>, <span class="pl-c1">Parent</span>.<span class="pl-c1">DeptName</span> <span class="pl-k">AS</span> <span class="pl-s"><span class="pl-pds">'</span>ParentName<span class="pl-pds">'</span></span>
  <span class="pl-k">FROM</span> Department
  <span class="pl-k">LEFT JOIN</span> Department <span class="pl-k">AS</span> Parent <span class="pl-k">ON</span> <span class="pl-c1">Department</span>.<span class="pl-c1">ParentId</span> <span class="pl-k">==</span> <span class="pl-c1">Parent</span>.<span class="pl-c1">DepartmentId</span>
  <span class="pl-k">WHERE</span> <span class="pl-c1">Parent</span>.<span class="pl-c1">DeptName</span> <span class="pl-k">LIKE</span> <span class="pl-s"><span class="pl-pds">'</span>%ale%<span class="pl-pds">'</span></span></pre></div>

<p><strong>Subquery</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
<span class="pl-k">var</span> subQuery = APQuery
   .<span class="pl-k">select</span>(d.DepartmentId)
   .<span class="pl-k">from</span>(d)
   .<span class="pl-k">where</span>(d.ParentId == <span class="pl-c1">0</span>);
APQuery
   .<span class="pl-k">select</span>(d.Asterisk)
   .<span class="pl-k">from</span>(d)
   .<span class="pl-k">where</span>(subQuery.exist());</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> Department.<span class="pl-k">*</span>
  <span class="pl-k">FROM</span> Department
  <span class="pl-k">WHERE</span> ( EXISTS (
    <span class="pl-k">SELECT</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>
      <span class="pl-k">FROM</span> Department
        <span class="pl-k">WHERE</span> <span class="pl-c1">Department</span>.<span class="pl-c1">ParentId</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>
  ) )</pre></div>

<p><strong>Paging Query</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
<span class="pl-k">var</span> e = APDBDef.Employee;
<span class="pl-k">var</span> query = APQuery
   .<span class="pl-k">select</span>(e.EmployeeId, e.Name, d.DeptName)
   .<span class="pl-k">from</span>(e, d.JoinInner(e.DepartmentId == d.DepartmentId))
   .primary(e.EmployeeId)
   .take(<span class="pl-c1">20</span>)
   .skip(<span class="pl-c1">20</span>);

<span class="pl-k">using</span> (APDBDef db = <span class="pl-k">new</span> APDBDef())
{
   <span class="pl-k">int</span> total = db.ExecuteSizeOfSelect(query);
   IDataReader records = db.ExecuteReader(query);
}</pre></div>

<p>Execute on SQLServer provider.</p>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-c1">COUNT</span>(<span class="pl-k">*</span>)
  <span class="pl-k">FROM</span> Employee,
    <span class="pl-k">INNER JOIN</span> Department <span class="pl-k">ON</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">=</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>

<span class="pl-k">SELECT</span> TOP <span class="pl-c1">20</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span>, <span class="pl-c1">Employee</span>.<span class="pl-c1">Name</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span>
  <span class="pl-k">FROM</span> Employee,
    <span class="pl-k">INNER JOIN</span> Department <span class="pl-k">ON</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">=</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>
  <span class="pl-k">WHERE</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span> NOT <span class="pl-k">IN</span> (
    <span class="pl-k">SELECT</span> TOP <span class="pl-c1">20</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span>
       <span class="pl-k">FROM</span> Employee
          <span class="pl-k">INNER JOIN</span> Department <span class="pl-k">ON</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">=</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>
  )</pre></div>

<p>Execute on Oracle provider.</p>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-c1">COUNT</span>(<span class="pl-k">*</span>)
  <span class="pl-k">FROM</span> Employee,
    <span class="pl-k">INNER JOIN</span> Department <span class="pl-k">ON</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">=</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>

<span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> ( <span class="pl-k">SELECT</span> query_alias.<span class="pl-k">*</span>, ROWNUM query_rownum <span class="pl-k">FROM</span> (
  <span class="pl-k">SELECT</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span>, <span class="pl-c1">Employee</span>.<span class="pl-c1">Name</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span>
    <span class="pl-k">FROM</span> Employee,
      <span class="pl-k">INNER JOIN</span> Department <span class="pl-k">ON</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">=</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>
  ) query_alias <span class="pl-k">WHERE</span> ROWNUM <span class="pl-k">&lt;=</span> <span class="pl-c1">40</span> ) <span class="pl-k">WHERE</span> query_rownum <span class="pl-k">&gt;</span> <span class="pl-c1">20</span>)</pre></div>

<p><strong>Aggregation &amp; Group By</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> t = APDBDef.Department;
<span class="pl-k">var</span> e = APDBDef.Employee;
APQuery
   .<span class="pl-k">select</span>(t.DepartmentId, t.DeptName, e.EmployeeId.Count())
   .<span class="pl-k">from</span>(t, e.JoinLeft(t.DepartmentId == e.DepartmentId))
   .group_by(t.DepartmentId, t.DeptName, e.EmployeeId)
   .having(e.EmployeeId.Count() &gt; <span class="pl-c1">0</span>);</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span>, <span class="pl-c1">COUNT</span>(<span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span>)
<span class="pl-k">FROM</span> Department
     <span class="pl-k">LEFT JOIN</span> Employee <span class="pl-k">ON</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">=</span> <span class="pl-c1">Employee</span>.<span class="pl-c1">DepartmentId</span>
<span class="pl-k">GROUP BY</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span>, <span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span>
<span class="pl-k">HAVING</span> <span class="pl-c1">COUNT</span>(<span class="pl-c1">Employee</span>.<span class="pl-c1">EmployeeId</span>) <span class="pl-k">&gt;</span> <span class="pl-c1">0</span></pre></div>

<p><strong>Aggregation with Date</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> t = APDBDef.Employee;
APQuery
   .<span class="pl-k">select</span>(t.Birthday.DateGroup(APSqlDateGroupMode.Month),
       <span class="pl-k">new</span> APSqlAggregationExpr(t.Birthday.DateGroup(APSqlDateGroupMode.Month), APSqlAggregationType.COUNT)))
   .<span class="pl-k">from</span>(t)
   .group_by(t.Birthday.DateGroup(APSqlDateGroupMode.Month));</pre></div>

<p>Execute on SQLServer provider.</p>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> DATEADD( mm, DATEDIFF( mm, <span class="pl-c1">0</span>, <span class="pl-c1">Employee</span>.<span class="pl-c1">Birthday</span> ), <span class="pl-c1">0</span> ),
   <span class="pl-c1">COUNT</span>( DATEADD( mm, DATEDIFF( mm, <span class="pl-c1">0</span>, <span class="pl-c1">Employee</span>.<span class="pl-c1">Birthday</span> ), <span class="pl-c1">0</span> ) )
   <span class="pl-k">FROM</span> Employee
   <span class="pl-k">GROUP BY</span> DATEADD( mm, DATEDIFF( mm, <span class="pl-c1">0</span>, <span class="pl-c1">Employee</span>.<span class="pl-c1">Birthday</span> ), <span class="pl-c1">0</span> )</pre></div>

<p>Execute on Oracle provider.</p>

<div class="highlight highlight-sql"><pre><span class="pl-k">SELECT</span> to_char(<span class="pl-c1">Employee</span>.<span class="pl-c1">Birthday</span>, <span class="pl-s"><span class="pl-pds">'</span>yyyy-mm<span class="pl-pds">'</span></span> ),
   <span class="pl-c1">COUNT</span>( to_char(<span class="pl-c1">Employee</span>.<span class="pl-c1">Birthday</span>, <span class="pl-s"><span class="pl-pds">'</span>yyyy-mm<span class="pl-pds">'</span></span> ) )
   <span class="pl-k">FROM</span> Employee
   <span class="pl-k">GROUP BY</span> to_char(<span class="pl-c1">Employee</span>.<span class="pl-c1">Birthday</span>, <span class="pl-s"><span class="pl-pds">'</span>yyyy-mm<span class="pl-pds">'</span></span> )</pre></div>

<p><strong>Insert</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
APQuery
   .insert(d)
      .<span class="pl-k">set</span>(d.DepartmentId, <span class="pl-c1">5</span>)
      .<span class="pl-k">set</span>(d.DeptName, <span class="pl-s"><span class="pl-pds">"</span>HR<span class="pl-pds">"</span></span>)
      .<span class="pl-k">set</span>(d.Phone, <span class="pl-s"><span class="pl-pds">"</span>000-111-2222<span class="pl-pds">"</span></span>);</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">INSERT INTO</span> Department
  (<span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">DeptName</span>, <span class="pl-c1">Department</span>.<span class="pl-c1">Phone</span>)
  <span class="pl-k">Values</span> (<span class="pl-c1">5</span>, <span class="pl-s"><span class="pl-pds">'</span>HR<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>000-111-2222<span class="pl-pds">'</span></span>)</pre></div>

<p><strong>Update</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
APQuery
   .update(d)
      .<span class="pl-k">set</span>(d.Phone, <span class="pl-s"><span class="pl-pds">"</span>000-111-3333<span class="pl-pds">"</span></span>)
   .<span class="pl-k">where</span>(d.DepartmentId == <span class="pl-c1">5</span>);</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">UPDATE</span> Department
    <span class="pl-k">SET</span> <span class="pl-c1">Department</span>.<span class="pl-c1">Phone</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>000-111-3333<span class="pl-pds">'</span></span>
  <span class="pl-k">WHERE</span> <span class="pl-c1">Department</span>.<span class="pl-c1">DepartmentId</span> <span class="pl-k">=</span> <span class="pl-c1">5</span></pre></div>

<p><strong>Delete</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
APQuery
   .delete(d)
   .<span class="pl-k">where</span>(d.ParentId == <span class="pl-c1">0</span>);</pre></div>

<div class="highlight highlight-sql"><pre><span class="pl-k">DELETE</span> Department
  <span class="pl-k">WHERE</span> <span class="pl-c1">Department</span>.<span class="pl-c1">ParentId</span> <span class="pl-k">=</span> <span class="pl-c1">0</span></pre></div>

<p><strong>Anonymous return</strong></p>

<div class="highlight highlight-cs"><pre><span class="pl-k">var</span> d = APDBDef.Department;
<span class="pl-k">var</span> query = APQuery
   .<span class="pl-k">select</span>(d.DepartmentId, d.DeptName)
   .<span class="pl-k">from</span>(d);

<span class="pl-k">using</span> (APDBDef db = <span class="pl-k">new</span> APDBDef())
{
   <span class="pl-k">var</span> records = db.Query(query, r =&gt;
   {
      <span class="pl-k">return</span> <span class="pl-k">new</span>
      {
         id = d.DepartmentId.GetValue(r),
         name = d.DeptName.GetValue(r)
      };
   });
}</pre></div>

<h2>
<a id="copyright-and-license" class="anchor" href="#copyright-and-license" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright and license</h2>

<p>Copyright (c) 2014-2015 Leo Caan. The license see <a href="LICENSE.md">LICENSE</a> file.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/leocaan/APQuery.net">APQuery.net</a> is maintained by <a href="https://github.com/leocaan">leocaan</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

